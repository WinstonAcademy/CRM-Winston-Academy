<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EditUserForm Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input, select { padding: 5px; margin: 5px; width: 200px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>EditUserForm Debug Test</h1>
    
    <div class="test-section">
        <h2>1. Test Backend API Directly</h2>
        <button onclick="testBackendAPI()">Test Backend API</button>
        <div id="backend-result" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Test Frontend Sync Logic</h2>
        <button onclick="testFrontendSync()">Test Frontend Sync</button>
        <div id="frontend-result" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Simulate EditUserForm Update</h2>
        <div>
            <label>User ID: <input type="number" id="userId" value="1"></label><br>
            <label>First Name: <input type="text" id="firstName" value="Test User"></label><br>
            <label>Last Name: <input type="text" id="lastName" value="Debug Test"></label><br>
            <label>Role: 
                <select id="role">
                    <option value="admin">Admin</option>
                    <option value="team_member">Team Member</option>
                </select>
            </label><br>
            <button onclick="simulateEditForm()">Simulate EditUserForm Update</button>
        </div>
        <div id="simulate-result" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Check Console Logs</h2>
        <p>Open browser console (F12) and look for sync logs when testing.</p>
        <button onclick="checkConsoleLogs()">Check for Sync Logs</button>
        <div id="console-result" class="log"></div>
    </div>

    <script>
        const STRAPI_URL = 'http://localhost:1337';
        
        async function testBackendAPI() {
            const resultDiv = document.getElementById('backend-result');
            resultDiv.innerHTML = 'Testing backend API...';
            
            try {
                // Get users
                const usersResponse = await fetch(`${STRAPI_URL}/api/users?populate=*`);
                const usersData = await usersResponse.json();
                
                if (usersData.data && usersData.data.length > 0) {
                    const testUser = usersData.data[0];
                    resultDiv.innerHTML = `
                        <div class="success">‚úÖ Backend API is working</div>
                        <div>Test User: ${testUser.username} (${testUser.firstName} ${testUser.lastName})</div>
                        <div>ID: ${testUser.id}, DocumentId: ${testUser.documentId}</div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå No users found in backend</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Backend API failed: ${error.message}</div>`;
            }
        }
        
        async function testFrontendSync() {
            const resultDiv = document.getElementById('frontend-result');
            resultDiv.innerHTML = 'Testing frontend sync logic...';
            
            try {
                // Test if we can access the frontend services
                const response = await fetch('http://localhost:3000/api/test');
                
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="success">‚úÖ Frontend is accessible</div>';
                } else {
                    resultDiv.innerHTML = '<div class="info">‚ÑπÔ∏è Frontend is running but no test endpoint</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Frontend not accessible: ${error.message}</div>`;
            }
        }
        
        async function simulateEditForm() {
            const resultDiv = document.getElementById('simulate-result');
            const userId = document.getElementById('userId').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const role = document.getElementById('role').value;
            
            resultDiv.innerHTML = 'Simulating EditUserForm update...';
            
            try {
                // Get current user data
                const usersResponse = await fetch(`${STRAPI_URL}/api/users?populate=*`);
                const usersData = await usersResponse.json();
                const testUser = usersData.data.find(u => u.id == userId);
                
                if (!testUser) {
                    resultDiv.innerHTML = '<div class="error">‚ùå User not found</div>';
                    return;
                }
                
                // Update user profile
                const updateData = {
                    data: {
                        username: testUser.username,
                        email: testUser.email,
                        firstName: firstName,
                        lastName: lastName,
                        role: role
                    }
                };
                
                console.log('üîÑ Simulating EditUserForm update:', updateData);
                
                const updateResponse = await fetch(`${STRAPI_URL}/api/users/${testUser.documentId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData)
                });
                
                if (updateResponse.ok) {
                    const updatedUser = await updateResponse.json();
                    resultDiv.innerHTML = `
                        <div class="success">‚úÖ EditUserForm simulation successful!</div>
                        <div>Updated: ${updatedUser.data.firstName} ${updatedUser.data.lastName} (${updatedUser.data.role})</div>
                    `;
                    
                    // Verify the change
                    setTimeout(async () => {
                        const verifyResponse = await fetch(`${STRAPI_URL}/api/users?populate=*`);
                        const verifyData = await verifyResponse.json();
                        const verifiedUser = verifyData.data.find(u => u.id == userId);
                        
                        if (verifiedUser.firstName === firstName && verifiedUser.lastName === lastName) {
                            resultDiv.innerHTML += '<div class="success">‚úÖ Change verified in backend!</div>';
                        } else {
                            resultDiv.innerHTML += '<div class="error">‚ùå Change not verified in backend!</div>';
                        }
                    }, 1000);
                    
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Update failed: ${updateResponse.status}</div>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Simulation failed: ${error.message}</div>`;
            }
        }
        
        function checkConsoleLogs() {
            const resultDiv = document.getElementById('console-result');
            resultDiv.innerHTML = `
                <div class="info">‚ÑπÔ∏è Check browser console (F12) for these logs:</div>
                <div>üîÑ handleUpdateUser called with:</div>
                <div>üîÑ Profile data:</div>
                <div>üîÑ Permission data:</div>
                <div>üîÑ Has profile changes:</div>
                <div>üîÑ Calling updateUserProfile...</div>
                <div>‚úÖ updateUserProfile completed</div>
                <div>üîÑ Syncing profile to backend for user</div>
                <div>‚úÖ Profile backend sync succeeded</div>
            `;
        }
        
        // Auto-test backend on load
        window.onload = function() {
            testBackendAPI();
        };
    </script>
</body>
</html>


